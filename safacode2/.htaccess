# SafeCode IDE - Apache Configuration

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /safecode/
  
  # IMPORTANTE: Servir arquivos estáticos diretamente SEM processar pelo PHP
  # Arquivos de assets (CSS, JS, imagens, fonts)
  RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|json|map)$ [NC]
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
  
  # Servir arquivos da pasta dist diretamente
  RewriteCond %{REQUEST_URI} ^/safecode/dist/(.*)$ [NC]
  RewriteCond %{DOCUMENT_ROOT}/safecode/dist/$1 -f
  RewriteRule ^dist/(.*)$ dist/$1 [L]
  
  # Servir arquivos da pasta assets diretamente
  RewriteCond %{REQUEST_URI} ^/safecode/assets/(.*)$ [NC]
  RewriteCond %{DOCUMENT_ROOT}/safecode/dist/assets/$1 -f
  RewriteRule ^assets/(.*)$ dist/assets/$1 [L]
  
  # Se o arquivo existe fisicamente, servir diretamente
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
  
  # Se o arquivo não existe na raiz, tentar servir do dist
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{DOCUMENT_ROOT}/safecode/dist%{REQUEST_URI} -f
  RewriteRule ^(.*)$ dist/$1 [L]
  
  # Redirecionar rotas SPA para index.php (que serve o dist/index.html)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.php [L]
</IfModule>

# Tipos MIME corretos - CRÍTICO para funcionar
<IfModule mod_mime.c>
  AddType text/css .css
  AddType application/javascript .js
  AddType application/json .json
  AddType image/png .png
  AddType image/jpeg .jpg .jpeg
  AddType image/gif .gif
  AddType image/svg+xml .svg
  AddType image/x-icon .ico
  AddType font/woff .woff
  AddType font/woff2 .woff2
  AddType font/ttf .ttf
  AddType font/eot .eot
  AddType application/wasm .wasm
</IfModule>

# Headers de segurança
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"
  
  # Headers corretos para assets
  <FilesMatch "\.(css|js)$">
    Header set Content-Type "text/css; charset=utf-8" env=CSS
    Header set Content-Type "application/javascript; charset=utf-8" env=JS
  </FilesMatch>
</IfModule>

# Cache para assets
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
</IfModule>
