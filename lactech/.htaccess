# ============================================
# LacTech - Configurações Básicas
# ============================================

# Bloquear listagem de diretórios
Options -Indexes

# ============================================
# URLs Amigáveis (APENAS EM PRODUÇÃO)
# ============================================
# Remove .php das URLs apenas em produção (não em localhost)
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Permitir acesso direto a arquivos existentes (sempre)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Exceção: NÃO processar arquivos da API (sempre)
    RewriteCond %{REQUEST_URI} ^.*/api/.*$ [NC]
    RewriteRule ^ - [L]
    
    # APENAS EM PRODUÇÃO: Verificar se NÃO é localhost
    # Se for localhost, não fazer rewrite (pula para o final)
    RewriteCond %{HTTP_HOST} ^localhost [NC,OR]
    RewriteCond %{HTTP_HOST} ^127\.0\.0\.1 [NC,OR]
    RewriteCond %{HTTP_HOST} ^::1 [NC,OR]
    RewriteCond %{HTTP_HOST} ^192\.168\. [NC]
    RewriteRule ^ - [L]
    
    # PRODUÇÃO: Redirecionar URLs com .php para versão sem extensão (301 permanente)
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php[\s?] [NC]
    RewriteCond %{REQUEST_URI} !^.*/api/ [NC]
    RewriteRule ^ %1 [R=301,L]
    
    # PRODUÇÃO: Se a URL não termina com .php e o arquivo .php existe, adicionar .php
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !\.(php|html|htm|css|js|jpg|jpeg|png|gif|svg|ico|woff|woff2|ttf|eot|json|xml|pdf)$ [NC]
    RewriteCond %{REQUEST_FILENAME}\.php -f
    RewriteRule ^(.*)$ $1.php [L]
</IfModule>

# Proteger arquivos sensíveis
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Proteger arquivo .env
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

# Proteger arquivos sensíveis
<FilesMatch "\.(bat|env|config|bak|sql|log)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Proteger arquivos de configuração sensíveis
<FilesMatch "^(config_google|config_mysql|config_login|config)\.php$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Compressão GZIP básica
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript application/json
</IfModule>

# Headers de segurança e cache
<IfModule mod_headers.c>
    # Segurança
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    
    # SEM CACHE para arquivos PHP (páginas dinâmicas)
    <FilesMatch "\.php$">
        Header always set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
        Header always set Pragma "no-cache"
        Header always set Expires "0"
    </FilesMatch>
    
    # Cache apenas para arquivos estáticos (CSS, JS, imagens)
    <FilesMatch "\.(css|js|jpg|jpeg|png|gif|svg|ico|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>
</IfModule>
